
[<img src="./images/Market.jpg" width="240" height="240">](https://github.com/InnokentiyKim/LearnEnglishTgBot/)

# Online Market - это REST API сервис для продажи и покупки разнообразных товаров.
> #### Сервис позволяет покупателям находить нужные товары, делать заказы, управлять ими, следить за их статусом и получать уведомления об изменениях
> #### Сервис позволяет продавцам создавать каталог товаров, управлять своим магазином, следить за продажами и заказами
> #### Маркет предоставляет менеджерам удобные инструменты для управления и мониторинга системами продаж
### Функционал сервиса позволяет:
> - <font color="green" >**пользователям регистрироваться и аутентифицироваться в сервисе с помощью jwt токена, выполнять сброс пароля**</font>
> - <font color="green">**просматривать каталог и категории товаров, выполнять поиск товаров, применять различные фильтры и сортировку**</font>
> - <font color="green">**добавлять товары в корзину, подтверждать заказы, применять скидочные купоны к заказам**</font>
> - <font color="green">**получать уведомления на email о статусе заказа с прикреплением отчета о созданном заказе в формате pdf**</font>
> - <font color="green">**для продавцов создавать и управлять магазинами, выполнять загрузку и обновление каталога товаров (асинхронно)**</font>
> - <font color="green">**для менеджеров предоставляется удобная адмнистративная панель для мониторинга и управления пользователями, магазинами и заказами, с возможностью выгружать данные в формате csv**</font>
> - <font color="green">**для тестирования и проверки работы сервиса предоставляется документация в формате swagger**</font>
### Технологии и инструменты
> - Django <img src="images/django-logo.svg" alt="Django" width="20" height="20">
> - PostgreSQL <img src="images/postgresql-logo.svg" alt="Postgresql" width="20" height="20">
> - Redis <img src="images/redis-logo.svg" alt="Redis" width="20" height="20">
> - Celery <img src="images/django-logo.svg" alt="Django" width="20" height="20">
> - RabbitMQ <img src="images/rabbitmq-logo.svg" alt="RabbitMQ" width="20" height="20">
> - Docker <img src="images/docker-logo.svg" alt="Docker" width="20" height="20">
> - Docker Compose <img src="images/compose-logo.svg" alt="Docker-Compose" width="20" height="20">
### Схема архитектуры сервиса
<img src="images/project_schema.png" alt="schema">
<hr>

- [Начало работы](#start)
  - [Настройка и запуск проекта](#environment)
  - [Переменные окружения](#variables)
  - [Зависимости](#dependencies)
- [Работа сервиса](#service)
  - [Пользователь](#user)
    - [Регистрация и аутентификация пользователя](#registration)
    - [Управление аккаунтом и контактами](#account_contacts)
    - [Получение каталога (категорий) товаров, списка магазинов и популярных товаров](#products)
  - [Покупатель](#buyer) 
    - [Работа с корзиной](#cart)
    - [Подтверждение и мониторинг статуса заказа](#order)
  - [Продавец](#seller)
    - [Создание магазина, получение и изменение статуса](#shop)
    - [Импорт товаров и обновление каталога](#goods)
    - [Получение заказов и активного каталога своих товаров](#shop_management)
  - [Менеджер](#manager)
    - [Мониторинг и управление заказами](#monitoring) 
    - [Получение и управление скидочными купонами](#coupons) 
    - [Работа с сайтом администрирования](#panel) 
- [Документация](#docs)

<a name="start"></a>
## 1. Начало работы

Запускать проект рекомендуется в Docker, однако возможно запустить его и вручную.
_Все необходимые действия и данные для работы сервиса описаны ниже._

<a name="environment"></a>
### 1.1. Настройка и запуск проекта

Для запуска проекта необходимо настроить переменные окружения (.env) и выполнить команду `docker-compose up`

<a name="variables"></a>
### 1.2. Переменные окружения
Всю чувствительную информацию, необходимую для работы сервиса, рекомендуется хранить в файле (.env)
_Список переменных окружения (по умолчанию/рекомендуемые):_.   
- Настройка основной базы данных PostgreSQL:
   >- _DB_ENGINE - движок базы данных (django.db.backends.postgresql)_.
   >- _DB_NAME - имя базы данных (retail_db)_
   >- _DB_USER - имя пользователя для подключения к БД (postgresql)_  
   >- _DB_PASSWORD - пароль пользователя для подключения к БД (postgres)_
   >- _DB_HOST - имя хоста (db)_
   >- _DB_PORT - номер порта (5432)_.    
- Настройка Redis для кэша:     
   >- _REDIS_CACHE_HOST - имя хоста (redis-cache)
   >- _REDIS_CACHE_PORT - номер порта (6379)
   >- _REDIS_CACHE_DB - номер базы (0).   
- Настройка Redis базы данных:    
   >- _REDIS_HOST - имя хоста (redis-db)
   >- _REDIS_PORT - номер порта (6380)
   >- _REDIS_DB - номер базы (0).   
- Настройка приложения Django:  
   >- _DEBUG - отключение режима отладки (False)
   >- _EMAIL_BACKEND - настройка почтового сервиса (django.core.mail.backends.smtp.EmailBackend)
   >- _EMAIL_HOST - хост почтового сервиса (smtp.gmail.com)
   >- _EMAIL_HOST_USER - имя пользователя почтового сервиса (innokentiykim90@gmail.com)
   >- _EMAIL_HOST_PASSWORD - пароль от почтового сервиса
   >- _EMAIL_PORT - порт почтового сервиса (587).   
- Настройка Celery:   
   >- _CELERY_BROKER_URL - настройка брокера сообщений (amqp://guest:guest@rabbitmq:5672/)
   >- _CELERY_RESULT_BACKEND - настройка бэкенда (redis://redis-db:6380/1)

<a name="dependencies"></a>
### 1.3. Зависимости

В случае ручного запуска проекта необходимо установить все зависимости.
    
_Используйте файл `requirements.txt` в корне проекта_


<a name="service"></a>
## 2. Работа сервиса

<a name="user"></a>
### 2.1. Пользователь

Пользователь может зарегистрироваться и входить в систему. 


<a name="registration"></a>
#### 2.1.1. Регистрация и аутентификация пользователя

<a name="account_contacts"></a>
#### 2.1.2. Управление аккаунтом и контактами


<a name="products"></a>
#### 2.1.3. Получение каталога (категорий) товаров, списка магазинов и популярных товаров

* Для получения подсказки нужно нажать на кнопку `Подсказка`.
* Подсказки можно брать неограниченное количество раз. 
* Подсказка представляет из себя описание слова на английском языке.
* При этом используется dictionary API.


<a name="buyer"></a>
### 2.2. Покупатель

* Для просмотра статистики нужно нажать на кнопку `Статистика`.
* Статистика включает количество изучаемых слов, просмотренных слов, правильных ответов и рейтинг пользователя.
* Также показывается список всех категорий изучаемых слов.


<a name="cart"></a>
#### 2.2.1. Работа с корзиной

* При запуске бота выполняется идентификация и инициализация игровой сессии.
* При старте подгружается информация о пользоваетеле и выполняется выборка слов из базы данных.
* В случае неизвестного пользователя, в базе данных создается запись о новом пользователе и 
* сохраняется список стандартных слов.
* ER-диаграмма сущностей представлена на схеме ниже.

<a name="order"></a>
#### 2.2.2. Подтверждение и мониторинг статуса заказа

* Новые слова добавляются командой `/add_word`.
* Новое слово вводится поэтапно: русское название, английское перевод, категория.
* На каждом шаге при некорректном вводе бот предложит попробовать еще раз.


<a name="seller"></a>
### 2.3. Продавец

* При нажатии на кнопку "Настройки" пользователю станут доступны изменения настроек игры:
>    - изменение количества слов в раунде `изменить количество слов раунда` - вводится целое число в указанном диапазоне 
>    - включить/выключить напоминания `Вкл/Выкл напоминания`  
>    - выбрать удобный режим перевода слов `изменить режим перевода` - с русского на английский и обратно
>    - вернуться к базовым настройкам `сбросить все настройки`.

<a name="shop"></a>
#### 2.3.1. Создание магазина, получение и изменение статуса

    * Новые слова добавляются командой `/add_word`.
    * Новое слово вводится поэтапно: русское название, английское перевод, категория.
    * На каждом шаге при некорректном вводе бот предложит попробовать еще раз.

<a name="import"></a>
#### 2.3.2. Импорт товаров и обновление каталога

    * Новые слова добавляются командой `/add_word`.
    * Новое слово вводится поэтапно: русское название, английское перевод, категория.
    * На каждом шаге при некорректном вводе бот предложит попробовать еще раз.

<a name="shop_management"></a>
#### 2.3.3. Получение заказов и активного каталога своих товаров
Эндпоинт `api/v1/manager/coupons` предоставляет возможность управлять скидочными купонами.   
Права доступа: `authenticated` и `admin user`.    
Работа со скидочными купонами подразумевает следующие действия:    
* Создание скидочного купона по запросу `POST /api/v1/manager/coupons`. Тело запроса:    
  - `code` - код купона (строка)
  - `valid_from` - дата начала действия купона (необязательно - дата в формате ISO)
  - `valid_to` - дата окончания действия купона (необязательно - дата в формате ISO)
  - `discount` - процент скидки (число в диапазоне от 0 до 100)
  - `active` - процент скидки (необязательно - логическая переменная)
* Получение скидочных купонов по запросу `GET /api/v1/manager/coupons`
* Изменение скидочного купона по запросу `PUT /api/v1/manager/coupons`. Тело запроса:    
  - `id` - id купона (целое число)
  - `<изменяемые(ое) поля>`


<a name="manager"></a>
### 2.4. Менеджер

<a name="monitoring"></a>
#### 2.4.1. Мониторинг и управление заказами 
Права доступа: `authenticated` и `admin user`.    
Работа с заказами подразумевает следующие действия:    
* Обновление статуса заказа по запросу `POST /api/v1/manager/orders`. Тело запроса:    
  - `id` - id заказа (целое число)
  - `state` - новый статус заказа (возможные значения: `CREATED, CONFIRMED, ASSEMBLED, SENT, DELIVERED, CANCELED`)
* Получение списка заказов по запросу `GET /api/v1/manager/orders`

<a name="coupons"></a>
#### 2.4.2. Получение и управление скидочными купонами 
Права доступа: `authenticated` и `admin user`.    
Работа со скидочными купонами подразумевает следующие действия:    
* Создание скидочного купона по запросу `POST /api/v1/manager/coupons`. Тело запроса:    
  - `code` - код купона (строка)
  - `valid_from` - дата начала действия купона (необязательно - дата в формате ISO)
  - `valid_to` - дата окончания действия купона (необязательно - дата в формате ISO)
  - `discount` - процент скидки (число в диапазоне от 0 до 100)
  - `active` - процент скидки (необязательно - логическая переменная)
* Получение скидочных купонов по запросу `GET /api/v1/manager/coupons`
* Изменение скидочного купона по запросу `PUT /api/v1/manager/coupons`. Тело запроса:    
  - `id` - id купона (целое число)
  - `<изменяемые(ое) поля>`

<a name="panel"></a>
#### 2.4.3. Работа с сайтом администрирования
Сайт администрирования доступен для администраторов (менеджеров) по адресу http://127.0.0.1:8000/admin/.  
Сайт администрирования предоставляет удобные инструменты и позволяет выполнять следующие действия:
* Просмотр и редактирование информации о пользователях, покупателях и продавцах (магазинах)
* Просмотр и редактирование информации о товарах, заказах и купонах
* Изменение статуса заказа
* Выгрузка любых выбранных данных в формате CSV


<a name="docs"></a>
## 3. Документация

Документация по проекту доступна в формате Swagger: [localhost:8000/api/schema](http://127.0.0.1:8000/api/schema/).  
**Заметка: Метод DELETE OpenAPI не поддерживает передачу тела запроса*


---
Автор:
[InnCent](https://github.com/InnokentiyKim/)
